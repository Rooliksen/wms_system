{% extends "wms/base.html" %}

{% block page_header %}
  <h4>Заявка № {{ order }}</h4>
{% endblock page_header %}


{% block content %}
<ul>
  <li scope="col"><b>Дата создания:</b> {{ order.date_created|date:'d.m.Y H:m' }}</li>
  <li scope="col"><b>Пользователь:</b> {{ order.customer }}</li>
  <li scope="col"><b>№ заявки клиента:</b> {{ order.logistic_order }}</li>
  <li scope="col"><b>Клиент:</b> {{ order.client }}</li>
  <li scope="col"><b>Статус:</b> {{ order.status }}</li>
  <li scope="col"><b>Дата приема:</b> {{ order.date_in|date:'d.m.Y' }}</li>
  <li scope="col"><b>Дата отгрузки:</b> {{ order.date_out|date:'d.m.Y' }}</li>
</ul>
<div class="row">
  <h4>Список всех грузов для добавления в заявку</h4>
</div>
<div class="row">
	<div class="col">
		<div class="card card-body">

			<form method="get">
				<a>Серийный номер: </a>{{myFilter.form.serial_num}}

		    <button class="btn btn-primary" type="submit">Search</button>
		  </form>

		</div>
	</div>
	
</div>
<table class="table table-bordered">
  <thead>
    <tr>
      <th scope="col">Статус</th>
      <th scope="col">Клиент</th>
      <th scope="col">Склад</th>
      <th scope="col">Дата приема</th>
      <th scope="col">Дата отгрузки</th>
      <th scope="col">Наименование</th>
      <th scope="col">Серийный номер</th>
    </tr>
  </thead>
  <tbody>
    {% for atm in atms %}
      <tr>
        <td>{{ atm.status }}</td>
        <td>{{ atm.client }}</td>
        <td>{{ atm.storage }}</td>
        <td>{{ atm.date_in|date:'d.m.Y' }}</td>
        <td>{{ atm.date_out|date:'d.m.Y' }}</td>
        <td>{{ atm.name }}</td>
        <td>
          <a href="{% url 'wms:atm' atm.id %}">{{ atm.serial_num }}</a>
        </td>
        <td>
          <a class="btn btn-sm btn-secondary" href="{% url 'wms:update_atm' atm.id %}">Изменить</a>
        </td>
        <td>
          <a class="btn btn-sm btn-secondary" href="{% url 'wms:new_order_item' order_id atm.id %}">Добавить</a>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td>Ничего не найдено.</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
<div class="row">
  <h4>Позиции в текущей заявке</h4>
</div>
<table class="table table-bordered">
  <thead>
    <tr>
      <th scope="col">Статус</th>
      <th scope="col">Клиент</th>
      <th scope="col">Склад</th>
      <th scope="col">Дата приема</th>
      <th scope="col">Дата отгрузки</th>
      <th scope="col">Наименование</th>
      <th scope="col">Серийный номер</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
      <tr>
        <td>{{ item.atm.status }}</td>
        <td>{{ item.atm.client }}</td>
        <td>{{ item.atm.storage }}</td>
        <td>{{ item.atm.date_in|date:'d.m.Y' }}</td>
        <td>{{ item.atm.date_out|date:'d.m.Y' }}</td>
        <td>{{ item.atm.name }}</td>
        <td>
          <a href="{% url 'wms:atm' item.atm.id %}">{{ item.atm.serial_num }}</a>
        </td>
        <td>
          <a class="btn btn-sm btn-secondary" href="{% url 'wms:update_atm' item.atm.id %}">Изменить</a>
        </td>
        <td>
          <a class="btn btn-sm btn-secondary" href="{% url 'wms:delete_orderitem_from_list' item.id %}">Удалить</a>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td>Не добавлено ни одного груза. Добавьте первый груз.</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock content %}